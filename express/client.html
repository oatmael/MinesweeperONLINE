<!DOCTYPE html>
<html>
<head>
  <title>Minesweeper</title>
  <style>
    .header {
        width: auto;
        background-color: lightblue;
        padding: 10;
    }
    .full {
        display:table;
        width: 100%;
        height: 500px;
    }
    .left {
        background-color: navy;
        display: table-cell;
        width: 60%;
        height: 100%;
    }
    .right {
        background-color: fuchsia;
        display: table-cell;
        width: 40%;
        height: 100%;
        position: relative;
        overflow: auto;
        padding: 10;
    }
    input.game {
        width: 20px;
    }

  </style>
</head>
<body>
    <div class="header">
        <a>Number of Mines: </a>
        <input type="text" id="numMines" value="20" class="game"/>
        <a>Width: </a>
        <input type="text" id="width" value="10" class="game"/>
        <a>Height: </a>
        <input type="text" id="height" value="10" class="game"/>
        <button onClick="newGame()">New Game</button>
        <input id="chat" type="text" width="100px"/>
        <button onClick="chat()">Chat</button>
    </div>
    <div class="full">
        <div class="left" id="game">

        </div>
        <div class="right" id="log">

        </div>
    </div>
</body>
<script>

var logDiv = document.getElementById("log");
var gameDiv = document.getElementById("game");

//const uid = randomNo(999);
var uid = prompt("Enter your name");

const ws = new WebSocket('ws://localhost:9898/');
ws.onopen = function() {
    console.log('WebSocket Client Connected');
    ws.send(JSON.stringify({"message":"connect", "value":uid}));
};
ws.onmessage = function(e) {
  console.log("Received: '" + e.data + "'");
  
  var jsonMessage = JSON.parse(e.data);
  
  switch (jsonMessage.message) {
    case "gameBoard":
        drawGameBoard(jsonMessage.value);
        break;
    default:
        var date = new Date().toUTCString();
        logDiv.innerHTML = 
            //date
            //+ "<a> " 
            "<a> " 
            + jsonMessage.message + ":" 
            + jsonMessage.value 
            + "</a><br/>"
            + logDiv.innerHTML;
  }
  
};

function drawGameBoard(board){
    var innerHTMLstring = "";

    innerHTMLstring += "<table>";
    for (var y = 0; y < board.height; y++){
        innerHTMLstring += "<tr>";
        for (var x = 0; x < board.width; x++){
            innerHTMLstring += "<td>";
            var display;
            switch (board.grid[y][x]){
                case -1:
                    display = "";
                    break;
                case -2:
                    display = "ðŸ’£";
                    break;
                default:
                    display = board.grid[y][x];
            }
            
            innerHTMLstring += "<button onClick='cellPress(" + x + "," + y + ")'>" + display + "</button>";
            innerHTMLstring += "</td>";
        }
        innerHTMLstring += "<tr>";
    }
    innerHTMLstring += "</table>";
    gameDiv.innerHTML = innerHTMLstring;
}

function randomNo(length){
    return Math.floor(Math.random() * length);
}

function newGame(){
    var numMines = document.getElementById("numMines").value;
    var width = document.getElementById("width").value;
    var height = document.getElementById("height").value;
    ws.send(JSON.stringify({
        "message":"newGame",
        "numMines":numMines,
        "width":width,
        "height":height
    }));
}

function cellPress(x,y) {
    ws.send(JSON.stringify({
        "message":"revealTile",
        "x":x,
        "y":y,
        "uid":uid
    }));
}

function chat(){
    var text = document.getElementById('chat').value;
    ws.send(JSON.stringify({
        "message":"chat",
        "uid":uid,
        "value":text
    }));
}

</script>
</html>